# Единый реестр ролей пользователей и матрица доступа

## Содержание
1. [Введение](#введение)
2. [Единый реестр ролей пользователей](#единый-реестр-ролей-пользователей)
3. [Матрица доступа к ресурсам и операциям](#матрица-доступа-к-ресурсам-и-операциям)
4. [Принципы управления доступом](#принципы-управления-доступом)
5. [Заключение](#заключение)

## Введение

Данный документ определяет единый реестр ролей пользователей и матрицу доступа к ресурсам и операциям для российского аналога платформы Steam. Цель документа — стандартизировать управление доступом во всех микросервисах, устранить противоречия в правах и обеспечить согласованность системы безопасности.

## Единый реестр ролей пользователей

### Основные роли

1.  **user (Пользователь)**
    - **Описание**: Стандартный пользователь платформы. Может покупать игры, управлять своей библиотекой, общаться с другими пользователями, оставлять отзывы.
    - **Наследование**: Базовая роль.

2.  **developer (Разработчик)**
    - **Описание**: Пользователь, имеющий право публиковать и управлять своими играми на платформе. Имеет доступ к Developer Service.
    - **Наследование**: Наследует права `user`.

3.  **publisher (Издатель)**
    - **Описание**: Организация или пользователь с расширенными правами по управлению несколькими играми (своими или других разработчиков). Имеет доступ к Developer Service с расширенными возможностями.
    - **Наследование**: Наследует права `developer`.

4.  **moderator (Модератор)**
    - **Описание**: Пользователь с правами модерации пользовательского контента (отзывы, комментарии, форумы, профили).
    - **Наследование**: Наследует права `user`.

5.  **support (Сотрудник поддержки)**
    - **Описание**: Сотрудник службы поддержки пользователей. Имеет доступ к информации о пользователях, транзакциях, может обрабатывать запросы на возврат средств, решать проблемы пользователей.
    - **Наследование**: Наследует права `user`.

6.  **admin (Администратор)**
    - **Описание**: Администратор платформы с полным доступом ко всем функциям управления системой, пользователями, контентом и настройками.
    - **Наследование**: Наследует права `support` и `moderator`.

### Системные роли

1.  **system (Система)**
    - **Описание**: Внутренняя роль для межсервисного взаимодействия, когда действие выполняется не от имени пользователя, а самой системой (например, фоновые задачи, обработка событий).
    - **Наследование**: Не наследует права пользователей.

2.  **anonymous (Анонимный пользователь)**
    - **Описание**: Пользователь, не прошедший аутентификацию. Имеет доступ только к публичным ресурсам (просмотр каталога, страниц игр).
    - **Наследование**: Не наследует права пользователей.

### Иерархия ролей

```
admin
  └── support
  └── moderator

publisher
  └── developer

user

anonymous

system
```

## Матрица доступа к ресурсам и операциям

В таблице ниже представлена матрица доступа, где:
- **R** - Read (Чтение)
- **C** - Create (Создание)
- **U** - Update (Обновление)
- **D** - Delete (Удаление)
- **M** - Manage (Полное управление, включая C, U, D и специфические действия)
- **X** - Execute (Выполнение специфической операции)
- **-** - Доступ запрещен

| Ресурс / Операция | Микросервис | anonymous | user | developer | publisher | moderator | support | admin | system |
|---|---|---|---|---|---|---|---|---|---|
| **Пользователи (Users)** | | | | | | | | | |
| Просмотр своего профиля | Account | - | R | R | R | R | R | R | - |
| Редактирование своего профиля | Account | - | U | U | U | U | U | U | - |
| Просмотр чужого профиля (публичные данные) | Account | R | R | R | R | R | R | R | - |
| Просмотр чужого профиля (приватные данные) | Account | - | - | - | - | - | R | R | - |
| Поиск пользователей | Account | - | R | R | R | R | R | R | - |
| Управление пользователями (блокировка, удаление) | Account/Admin | - | - | - | - | - | U | M | - |
| Регистрация | Auth | C | - | - | - | - | - | - | - |
| Аутентификация | Auth | X | X | X | X | X | X | X | - |
| Управление сессиями (своими) | Auth | - | D | D | D | D | D | D | - |
| Управление сессиями (чужими) | Auth/Admin | - | - | - | - | - | D | M | - |
| **Игры (Games)** | | | | | | | | | |
| Просмотр каталога игр | Catalog | R | R | R | R | R | R | R | - |
| Просмотр страницы игры | Catalog | R | R | R | R | R | R | R | - |
| Поиск игр | Catalog | R | R | R | R | R | R | R | - |
| Создание/Публикация своей игры | Catalog/Developer | - | - | C | C | - | - | C | - |
| Редактирование своей игры | Catalog/Developer | - | - | U | U | - | - | U | - |
| Удаление своей игры | Catalog/Developer | - | - | D | D | - | - | D | - |
| Управление чужими играми (модерация, публикация) | Catalog/Admin | - | - | - | - | U | - | M | - |
| Управление категориями/тегами | Catalog/Admin | - | - | - | - | - | - | M | - |
| Загрузка файлов игры (своей) | Download/Developer | - | - | C | C | - | - | C | - |
| Управление версиями игры (своей) | Download/Developer | - | - | M | M | - | - | M | - |
| Загрузка файлов игры (чужой) | Download/Admin | - | - | - | - | - | - | M | - |
| **Библиотека (Library)** | | | | | | | | | |
| Просмотр своей библиотеки | Library | - | R | R | R | R | R | R | - |
| Добавление игры в библиотеку (покупка) | Library/Payment | - | C | C | C | C | C | C | - |
| Установка/Удаление игры из библиотеки | Library/Download | - | X | X | X | X | X | X | - |
| Просмотр библиотеки другого пользователя | Library | - | - | - | - | - | R | R | - |
| **Платежи (Payments)** | | | | | | | | | |
| Просмотр своих транзакций | Payment | - | R | R | R | R | R | R | - |
| Пополнение кошелька | Payment | - | C | C | C | C | C | C | - |
| Совершение покупки | Payment | - | C | C | C | C | C | C | - |
| Запрос возврата средств | Payment | - | C | C | C | C | C | C | - |
| Обработка возврата средств | Payment/Support | - | - | - | - | - | X | M | - |
| Просмотр чужих транзакций | Payment/Support | - | - | - | - | - | R | R | - |
| Управление платежными методами | Payment/Admin | - | - | - | - | - | - | M | - |
| **Социальные функции (Social)** | | | | | | | | | |
| Отправка/Принятие запросов в друзья | Social | - | X | X | X | X | X | X | - |
| Просмотр списка друзей | Social | - | R | R | R | R | R | R | - |
| Отправка личных сообщений | Social | - | C | C | C | C | C | C | - |
| Создание/Управление группами | Social | - | M | M | M | M | M | M | - |
| Публикация отзывов | Social | - | C | C | C | C | C | C | - |
| Модерация отзывов/комментариев | Social/Moderator | - | - | - | - | M | - | M | - |
| Просмотр форумов | Social | R | R | R | R | R | R | R | - |
| Создание тем/сообщений на форуме | Social | - | C | C | C | C | C | C | - |
| Модерация форумов | Social/Moderator | - | - | - | - | M | - | M | - |
| **Уведомления (Notifications)** | | | | | | | | | |
| Получение своих уведомлений | Notification | - | R | R | R | R | R | R | - |
| Управление настройками уведомлений | Account | - | U | U | U | U | U | U | - |
| Отправка системных уведомлений | Notification/Admin | - | - | - | - | - | - | C | C |
| **Аналитика (Analytics)** | | | | | | | | | |
| Просмотр своей статистики (разработчик) | Analytics/Developer | - | - | R | R | - | - | R | - |
| Просмотр общей статистики платформы | Analytics/Admin | - | - | - | - | - | - | R | - |
| **Администрирование (Admin)** | | | | | | | | | |
| Управление ролями пользователей | Admin | - | - | - | - | - | - | M | - |
| Управление глобальными настройками | Admin | - | - | - | - | - | - | M | - |
| Просмотр логов системы | Admin | - | - | - | - | - | - | R | - |

**Примечания:**
- Данная матрица является базовой и может быть дополнена более гранулярными разрешениями по мере детализации функциональности.
- Доступ к ресурсам часто подразумевает доступ к связанным операциям (например, чтение игры включает чтение ее метаданных).
- Роль `system` используется для внутренних операций и не должна назначаться пользователям.
- Роль `admin` имеет максимальные права, но ее использование должно быть ограничено и аудироваться.

## Принципы управления доступом

1.  **Централизованное управление ролями**: Роли и их базовые разрешения определяются централизованно (например, в Auth Service или Admin Service).
2.  **Децентрализованная проверка прав**: Каждый микросервис отвечает за проверку прав доступа к своим ресурсам на основе информации о роли пользователя, полученной от API Gateway или из токена.
3.  **Принцип наименьших привилегий**: Каждая роль должна иметь только те права, которые необходимы для выполнения ее функций.
4.  **Аудит доступа**: Все операции, связанные с изменением прав доступа и критически важными действиями, должны логироваться для аудита.
5.  **Гибкость**: Система должна позволять администраторам (роль `admin`) создавать кастомные роли и настраивать их разрешения при необходимости (хотя базовые роли должны покрывать 99% случаев).
6.  **Передача информации о ролях**: API Gateway должен извлекать роли пользователя из токена (валидированного через Auth Service) и передавать их внутренним сервисам через безопасные заголовки (например, `X-User-Roles`).

## Заключение

Единый реестр ролей и матрица доступа обеспечивают стандартизированный и согласованный подход к управлению правами пользователей на платформе. Это повышает безопасность, упрощает разработку и поддержку микросервисов. Важно поддерживать эти документы в актуальном состоянии и строго следовать определенным принципам управления доступом при дальнейшей разработке.
