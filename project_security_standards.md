# Стандарты Безопасности

**Версия:** 1.0
**Дата последнего обновления:** 2024-07-16

## 1. Введение

Данный документ определяет единые стандарты безопасности для российского аналога платформы Steam. Цель документа — обеспечить согласованный подход к обеспечению безопасности всех микросервисов платформы.

## 2. Стандарты Безопасности

### 2.1. Аутентификация и Авторизация

#### 2.1.1. Аутентификация пользователей
*   **Протокол**: OAuth 2.0 с OpenID Connect.
*   **Токены**: JWT (JSON Web Tokens).
*   **Хранение токенов**:
    *   Access token: в памяти клиента (не в localStorage/cookies).
    *   Refresh token: в HttpOnly, Secure, SameSite=Strict cookie.
*   **Срок действия токенов**:
    *   Access token: 15 минут.
    *   Refresh token: 7 дней.
*   **Ротация refresh токенов**: при каждом использовании.
*   **Библиотека для Go**: `github.com/golang-jwt/jwt/v5`.

#### 2.1.2. Авторизация
*   **Модель**: RBAC (Role-Based Access Control).
*   **Проверка прав**: на уровне API Gateway и внутри каждого микросервиса.
*   **Формат передачи информации о ролях**:
    *   В JWT-токене: поле `roles` с массивом строк.
    *   В заголовках между сервисами: `X-User-Roles`.
*   **Библиотека для Go**: `github.com/casbin/casbin/v2`.

#### 2.1.3. Межсервисная аутентификация
*   **Протокол**: mTLS (mutual TLS).
*   **Сертификаты**: выдаются внутренним CA (Certificate Authority).
*   **Срок действия сертификатов**: 90 дней с автоматическим обновлением.
*   **Библиотека для Go**: стандартная библиотека `crypto/tls`.

#### 2.1.4. Защита API
*   **Rate limiting**: на уровне API Gateway.
    *   Глобальный лимит: 1000 запросов в минуту на IP.
    *   Лимит для аутентифицированных пользователей: 100 запросов в минуту на пользователя.
    *   Лимит для критичных эндпоинтов (аутентификация, платежи): 10 запросов в минуту.
*   **Защита от CSRF**: для всех модифицирующих операций (POST, PUT, DELETE).
    *   Double Submit Cookie pattern.
    *   Библиотека для Go: `github.com/gorilla/csrf`.
*   **Защита от XSS**:
    *   Content-Security-Policy (CSP) заголовки.
    *   Экранирование всех пользовательских данных при выводе.
*   **Защита от SQL-инъекций**:
    *   Использование параметризованных запросов.
    *   ORM: `github.com/go-gorm/gorm`.
*   **Защита от DDOS**:
    *   WAF (Web Application Firewall) на уровне инфраструктуры.
    *   **Российский аналог Cloudflare (например, Qrator Labs, DDoS-Guard) или аналогичные решения от российских провайдеров.** Использование иностранных сервисов защиты от DDoS будет рассмотрено только в случае отсутствия адекватных российских аналогов и при условии соответствия законодательству РФ.
*   **Обработка Персональных Данных (ПДн) через API:** При проектировании и реализации API эндпоинтов, обрабатывающих ПДн, необходимо строго соблюдать требования ФЗ-152, включая получение согласий, обеспечение безопасности при передаче и минимизацию обрабатываемых данных. **Все операции с персональными данными российских граждан должны осуществляться с использованием серверов, расположенных на территории РФ (в частности, на инфраструктуре хостинг-провайдера Beget).**

### 2.2. Шифрование Данных

#### 2.2.1. Данные в движении (Data in Transit)
*   **Протокол**: TLS 1.3.
*   **Минимальный уровень шифрования**: `TLS_AES_128_GCM_SHA256`.
*   **Настройка HTTPS**: HSTS, secure cookies, правильные cipher suites.

#### 2.2.2. Данные в покое (Data at Rest)
*   **Шифрование базы данных**: на уровне файловой системы (LUKS).
*   **Шифрование чувствительных данных в БД**:
    *   Пароли: bcrypt с фактором стоимости 12 или Argon2id (предпочтительно для новых реализаций).
    *   Платежная информация: AES-256-GCM.
    *   Библиотека для Go: `golang.org/x/crypto/bcrypt`, `golang.org/x/crypto/argon2`.
*   Особое внимание уделяется защите персональных данных (ПДн) российских пользователей, которые должны храниться и обрабатываться в соответствии с ФЗ-152. **Персональные данные российских граждан хранятся и обрабатываются на серверах, физически расположенных на территории Российской Федерации. Платформа использует инфраструктуру российского хостинг-провайдера Beget для размещения своих сервисов и данных.** Это включает требования к шифрованию и другим мерам безопасности при хранении. Платежная информация обрабатывается с учетом требований 54-ФЗ и стандартов платежных систем.
*   **Шифрование файлов**: AES-256-GCM для хранимых файлов игр (Download Service), игровых сохранений (Library Service), и других чувствительных файлов.
*   **Фискальные данные:** Особое внимание к защите данных, передаваемых в ОФД, и ключей для фискализации (Payment Service).

#### 2.2.3. Управление секретами
*   **Хранение секретов**: HashiCorp Vault или Kubernetes Secrets (зашифрованные).
*   **Доступ к секретам**: Через API Vault с аутентификацией (например, Kubernetes Service Account JWT) или через смонтированные Kubernetes Secrets.
*   **Ротация секретов**: Регулярная, автоматизированная где возможно (например, для ключей API внешних сервисов). Период ротации зависит от типа секрета (например, ключи API платежных систем - раз в год или по требованию провайдера; внутренние ключи шифрования - раз в 1-2 года).
*   **Библиотека для Go**: `github.com/hashicorp/vault/api` (для Vault), стандартные средства Kubernetes для Secrets.

### 2.3. Безопасность Кода и Инфраструктуры

#### 2.3.1. Статический анализ кода
*   **Инструменты для Go**:
    *   `gosec` для анализа безопасности.
    *   `golangci-lint` для общего анализа кода.
*   **Интеграция**: в CI/CD pipeline, блокирование сборки при критических уязвимостях.

#### 2.3.2. Сканирование зависимостей
*   **Инструменты**:
    *   `nancy` для Go-зависимостей.
    *   `trivy` для образов Docker.
*   **Интеграция**: в CI/CD pipeline, блокирование сборки при критических уязвимостях.

#### 2.3.3. Безопасность контейнеров
*   **Базовые образы**: минимальные образы (scratch, alpine).
*   **Пользователь**: запуск от непривилегированного пользователя.
*   **Сканирование**: перед деплоем в любое окружение.
*   **Иммутабельность**: запрет на изменение запущенных контейнеров.

#### 2.3.4. Безопасность Kubernetes
*   **RBAC**: строгое разграничение прав.
*   **Network Policies**: изоляция сетевого трафика между подами.
*   **Pod Security Policies**: запрет на привилегированные контейнеры.
*   **Secrets**: шифрование секретов в etcd.

### 2.4. Аудит Безопасности

#### 2.4.1. Логирование событий безопасности
*   **События для логирования**:
    *   Все попытки аутентификации (успешные и неуспешные).
    *   Изменения прав доступа.
    *   Доступ к чувствительным данным, включая любые операции с персональными данными (ПДн) российских пользователей (просмотр, изменение, удаление).
    *   Изменения в конфигурации системы.
*   **Формат логов**: JSON с обязательными полями (см. Стандарты Логирования).

#### 2.4.2. Мониторинг безопасности
*   **Инструменты**:
    *   SIEM-система (Security Information and Event Management).
    *   IDS/IPS (Intrusion Detection/Prevention System).
*   **Метрики**:
    *   Количество неудачных попыток аутентификации.
    *   Аномальная активность пользователей.
    *   Подозрительные запросы к API.

#### 2.4.3. Регулярные проверки
*   **Penetration testing**: каждые 6 месяцев.
*   **Vulnerability assessment**: каждые 3 месяца.
*   **Compliance check**: каждый месяц (общий).
*   **Проверка на соответствие требованиям законодательства РФ в области защиты информации и персональных данных (ФЗ-152, ФЗ-54 и др.).**

### 2.5. Безопасность Frontend Приложений
*   **Безопасность Frontend Приложений (Flutter):**
    *   **Хранение токенов:** Access token должен храниться в памяти. Refresh token и другие чувствительные данные на клиенте (если необходимо их хранить) должны сохраняться с использованием безопасных хранилищ (`flutter_secure_storage` или аналогичных платформенных механизмов).
    *   **Защита от XSS (для Web):** Если Frontend собирается для Web, необходимо применять стандартные практики защиты от XSS, включая Content Security Policy (CSP) и корректное экранирование данных, выводимых в DOM. Flutter Web по умолчанию использует CanvasKit или HTML рендереры, которые имеют свои особенности в контексте XSS, требующие внимания.
    *   **API Взаимодействие:** Все вызовы к бэкенд API должны осуществляться через HTTPS. Frontend не должен содержать захардкоженных ключей API или других секретов; они должны получаться от бэкенда или через безопасные конфигурационные механизмы.
    *   **Проверка кода и зависимостей:** Регулярно проводить анализ безопасности кода Flutter-приложения и его зависимостей.

### 2.6. Соответствие законодательству РФ (Compliance with RF Legislation)

Платформа "Российский Аналог Платформы Steam" разрабатывается с учетом строгого соблюдения действующего законодательства Российской Федерации. Ключевые аспекты включают:

*   **Федеральный закон № 152-ФЗ "О персональных данных":**
    *   Все персональные данные российских граждан собираются, записываются, систематизируются, накапливаются, хранятся, уточняются (обновляются, изменяются), извлекаются с использованием баз данных, находящихся на территории Российской Федерации.
    *   Для этих целей платформа использует серверную инфраструктуру российского хостинг-провайдера Beget.
    *   Реализованы все необходимые организационные и технические меры для защиты ПДн от неправомерного или случайного доступа, уничтожения, изменения, блокирования, копирования, предоставления, распространения, а также от иных неправомерных действий в отношении ПДн.
    *   Получение согласий на обработку ПДн осуществляется в явной форме, где это требуется законом.
*   **Федеральный закон № 54-ФЗ "О применении контрольно-кассовой техники...":**
    *   Все расчеты, требующие применения контрольно-кассовой техники (ККТ), фискализируются.
    *   Payment Service обеспечивает интеграцию с Оператором Фискальных Данных (ОФД) для передачи фискальных чеков в Федеральную Налоговую Службу (ФНС) России в соответствии с требованиями закона.
*   **Иные нормативные акты:**
    *   Платформа также учитывает требования других применимых законов и подзаконных актов, касающихся хранения данных, информационной безопасности и электронной коммерции.
    *   Регулярно проводится мониторинг изменений в законодательстве для своевременной адаптации процессов и систем платформы.

---
*Раздел "Стандарты безопасности" извлечен из документа "(Дополнительный фаил) Стандарты безопасности, мониторинга, логирования и трассировки.txt".*
*Этот документ должен регулярно обновляться и дополняться по мере развития платформы и изменения ландшафта угроз.*
